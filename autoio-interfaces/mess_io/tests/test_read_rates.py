""" test mess_io.reader.rates
"""

import os
import numpy
from ioformat import read_text_file
import mess_io.reader


PATH = os.path.dirname(os.path.realpath(__file__))
KTP_OUT_STR = read_text_file(['data', 'out'], 'rate.out', PATH)
KE_OUT_STR = read_text_file(['data', 'out'], 'ke.out', PATH)

# Set the REACTANT and PRODUCT
REACTANT = 'W1'
PRODUCT = 'W3'


def test__ktp_dct():
    """ test mess_io.reader.rates.ktp_dct
    """

    ref_ktp_dct = {
        'high': (
            (500.0, 650.0, 800.0, 950.0,
             1100.0, 1250.0, 1400.0, 1550.0,
             1700.0, 1850.0, 2000.0),
            (0.00123704, 2.07339, 295.551, 9910.26,
             135400.0, 1024120.0, 5143860.0, 19234000.0,
             57729800.0, 146453000.0, 325721000.0)),
        0.1: (
            (500.0, 650.0, 800.0, 950.0,
             1100.0, 1250.0, 1400.0, 1550.0,
             1700.0, 1850.0, 2000.0),
            (0.000536676, 0.127095, 3.43383, 25.6351,
             84.5986, 327.575, 1392.42, 4112.93,
             9141.18, 14058.6, 19558.3)),
        1.0: (
            (500.0, 650.0, 800.0, 950.0,
             1100.0, 1250.0, 1400.0, 1550.0,
             1700.0, 1850.0, 2000.0),
            (0.000892079, 0.395065, 11.9261, 114.45,
             473.081, 1469.97, 6064.93, 21266.3,
             62019.4, 138742.0, 279227.0)),
        10.0: (
            (500.0, 650.0, 800.0, 950.0,
             1100.0, 1250.0, 1400.0, 1550.0,
             1700.0, 1850.0, 2000.0),
            (0.00114645, 1.04871, 46.0872, 471.742,
             2410.59, 7623.67, 23580.8, 76336.0,
             235593.0, 587439.0, 1322680.0)),
        100.0: (
            (500.0, 650.0, 800.0, 950.0,
             1100.0, 1250.0, 1400.0, 1550.0,
             1700.0, 1850.0, 2000.0),
            (0.00122221, 1.76651, 145.044, 1977.75,
             10753.1, 37345.5, 105181.0, 268989.0,
             728117.0, 1802380.0, 4143210.0))
    }

    ktp_dct = mess_io.reader.rates.ktp_dct(
        KTP_OUT_STR, REACTANT, PRODUCT)

    assert set(ktp_dct.keys()) == set(ref_ktp_dct.keys())
    for pressure, tk_arr in ktp_dct.items():
        # temps, kts = tk_arr[0], tk_arr[1]
        # ref_tk_arr = ktp_dct[pressure]
        assert numpy.allclose(tk_arr, ref_ktp_dct[pressure])


def test__ke_dct():
    """ test mess_io.reader.rates.ke_dct
    """

    ref_ke_dct = {
        0.0: 0.0, 0.2: 7.76e-15, 0.4: 1.1e-13,
        0.6: 4.49e-13, 0.8: 1.54e-12,
        1.0: 4.53e-12, 1.2: 1.25e-11, 1.4: 3.15e-11,
        1.6: 7.32e-11, 1.8: 1.67e-10, 2.0: 3.66e-10,
        2.2: 7.76e-10, 2.4: 1.59e-09, 2.6: 3.22e-09,
        2.8: 6.36e-09, 3.0: 1.23e-08, 3.2: 2.36e-08,
        3.4: 4.44e-08, 3.6: 8.25e-08, 3.8: 1.51e-07,
        4.0: 2.75e-07, 4.2: 4.93e-07, 4.4: 8.77e-07,
        4.6: 1.55e-06, 4.8: 2.7e-06, 5.0: 4.68e-06,
        5.2: 8.06e-06, 5.4: 1.38e-05, 5.6: 2.34e-05,
        5.8: 3.94e-05, 6.0: 6.6e-05, 6.2: 0.000109997,
        6.4: 0.000182243, 6.6: 0.000300318, 6.8: 0.000492433,
        7.0: 0.000803405, 7.2: 0.0013047, 7.4: 0.00210909,
        7.6: 0.00339475, 7.8: 0.00544102, 8.0: 0.00868544,
        8.2: 0.0138106, 8.4: 0.0218763, 8.6: 0.0345266,
        8.8: 0.0542978, 9.0: 0.085099, 9.2: 0.132925,
        9.4: 0.206959, 9.6: 0.321211, 9.8: 0.497013,
        10.0: 0.766741, 10.2: 1.17942, 10.4: 1.80909,
        10.6: 2.76729, 10.8: 4.22164, 11.0: 6.42348,
        11.2: 9.74868, 11.4: 14.7583, 11.6: 22.2877,
        11.8: 33.5782, 12.0: 50.4699}

    ke_dct = mess_io.reader.rates.ke_dct(
        KE_OUT_STR, REACTANT, PRODUCT)

    assert set(ke_dct.keys()) == set(ref_ke_dct.keys())
    for ene, ratek in ke_dct.items():
        assert numpy.isclose(ratek, ref_ke_dct[ene])


if __name__ == '__main__':
    test__ktp_dct()
    test__ke_dct()
